#:kivy 2.0
#:import MDTopAppBar kivymd.uix.toolbar.MDTopAppBar

<BookItem>:
    orientation: 'vertical'
    size_hint_y: None
    height: self.minimum_height
    padding: dp(8)
    spacing: dp(6)
    on_release: app.open_book_detail(root.book_id, root.title, root.authors, root.cover_url, root.page_count, root.description)
    ripple_behavior: True
    
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 0.95, 1
        RoundedRectangle:
            size: self.size
            pos:self.pos
            radius: [10,]

    AsyncImage:
        source: root.cover_url if root.cover_url else "data/logo/kivy-icon-256.png"
        size_hint_y: None
        height: dp(140)
        allow_stretch: True
        keep_ratio: True


    MDLabel:
        text: root.title # Este será o titulo
        halign: 'center'
        theme_text_color: "Primary"
        size_hint_y: None
        height: self.texture_size[1] + dp(10)
        font_style: "Caption"
        shorten: True
        max_lines: 2
        ellipsize: "end"

ScreenManager:
    MainScreen:
    BookDetailScreen:

<MainScreen>:
    name: 'main_screen'
    BoxLayout:
        orientation: 'vertical'

        MDTopAppBar:
            title: "Roots"
            elevation: 4
            left_action_items: [["arrow-left", lambda x: app.clear_books_grid()]]

        MDBoxLayout:
            adaptive_height: True
            padding: dp(16)

            MDTextField:
                id: input_field
                hint_text: "Adicione um livro..."
                mode: "round"
                on_text_validate: app.add_book_search(self.text)
                on_focus: self.hint_text = "Adicione um livro..." if self.focus else ""
                icon_right: "magnify"
                icon_right_on_focus: "magnify"

        ScrollView:
            GridLayout:
                id: books_grid
                cols: 2
                size_hint_y: None
                padding: dp(16)
                spacing: dp(10)
                height: self.minimum_height


<BookDetailScreen>:
    name: 'detail_screen'
    BoxLayout:
        orientation: 'vertical'

        MDTopAppBar:
            title: "Detalhes do livro"
            elevation: 4
            left_action_items: [["arrow-left", lambda x: app.go_home()]]

        ScrollView:
            MDBoxLayout:
                orientation: 'vertical'
                padding: dp(16)
                spacing: dp(12)
                adaptive_height: True

                AsyncImage:
                    source: root.cover_url if root.cover_url else "data/logo/kivy-icon-256.png"
                    size_hint_y: None
                    height: dp(220)
                    allow_stretch: True
                    keep_ratio: True

                MDLabel:
                    text: root.book_title
                    font_style: "H1"
                    halign: "center"
                    size_hint_y: None
                    text_size: self.width, None
                    height: self.texture_size[1]

                MDLabel:
                    text: root.authors
                    theme_text_color: "Secondary"
                    halign: "center"
                    size_hint_y: None
                    text_size: self.width, None
                    height: self.texture_size[1]

                MDLabel:
                    text: f"{root.page_count} páginas" if root.page_count else ""
                    halign: "center"
                    size_hint_y: None
                    text_size: self.width, None
                    height: self.texture_size[1]

                Widget:
                    size_hint_y: None
                    height: dp(8)

                MDRaisedButton:
                    text: "Adicionar"
                    pos_hint: {"center_x": 0.5}
                    on_release: app.save_from_detail()
